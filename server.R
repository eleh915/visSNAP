library(ggvis)
library(lpSolve)
library(lpSolveAPI)
library(shiny)
library(dplyr)

usda <- read.csv("./data/usda.csv")
nutrients <- read.csv("./data/nutrientByDemoT.csv")
usdaTable <- read.csv("./data/usdaTable.csv")

function(input, output, session) {
  
  # feed in user input to create model
  x <- reactive({
    
    # set up optimization eq maximizing protein given constraints
    maxProt <- lp("min",
                  switch(input$select, 
                         "Cost" = usda$PricePerServ,
                         "Calories" = usda$CalsPerServ,
                         "Saturated Fat" = usda$SatFatPerServ,
                         "Sugar" = usda$SugarPerServ,
                         "Sodium" = usda$SodiumPerServ),
                  rbind(usda$ProtPerServ, usda$ProtPerServ, usda$SatFatPerServ, usda$SatFatPerServ,
                        usda$PricePerServ, usda$PricePerServ, usda$SodiumPerServ, usda$SodiumPerServ,
                        usda$FiberPerServ, usda$FiberPerServ, usda$SugarPerServ, usda$SugarPerServ,
                        usda$CalsPerServ, usda$CalsPerServ, usda$Fruits, usda$Vegs, usda$Grains,
                        usda$MeatFish, usda$Dairy,
                        usda$X1, usda$X2, usda$X3, usda$X4, usda$X5, usda$X6, usda$X7, usda$X8, usda$X9,                                  usda$X10, usda$X11, usda$X12, usda$X13, usda$X14, usda$X15, usda$X16, usda$X17, usda$X18, usda$X19, usda$X20, usda$X21, usda$X22, usda$X23, usda$X24, usda$X25, usda$X26, usda$X27, usda$X28, usda$X29, usda$X30, usda$X31, usda$X32, usda$X33, usda$X34, usda$X35, usda$X36, usda$X37, usda$X38, usda$X39, usda$X40, usda$X41, usda$X42, usda$X43, usda$X44, usda$X45, usda$X46, usda$X47, usda$X48, usda$X49, usda$X50, usda$X51, usda$X52, usda$X53, usda$X54, usda$X55, usda$X56, usda$X57, usda$X58, usda$X59, usda$X60, usda$X61, usda$X62, usda$X63, usda$X64, usda$X65, usda$X66, usda$X67, usda$X68, usda$X69, usda$X70, usda$X71, usda$X72, usda$X73, usda$X74, usda$X75, usda$X76, usda$X77, usda$X78, usda$X79, usda$X80, usda$X81, usda$X82, usda$X83, usda$X84, usda$X85, usda$X86, usda$X87, usda$X88, usda$X89, usda$X90, usda$X91, usda$X92, usda$X93, usda$X94, usda$X95, usda$X96, usda$X97, usda$X98, usda$X99, usda$X100, usda$X101, usda$X102, usda$X103, usda$X104, usda$X105, usda$X106, usda$X107, usda$X108, usda$X109, usda$X110, usda$X111, usda$X112, usda$X113, usda$X114, usda$X115, usda$X116, usda$X117, usda$X118, usda$X119, usda$X120, usda$X121, usda$X122, usda$X123, usda$X124, usda$X125, usda$X126, usda$X127, usda$X128, usda$X129, usda$X130, usda$X131, usda$X132, usda$X133, usda$X134, usda$X135, usda$X136, usda$X137, usda$X138, usda$X139, usda$X140, usda$X141, usda$X142, usda$X143, usda$X144, usda$X145, usda$X146, usda$X147, usda$X148, usda$X149, usda$X150, usda$X151, usda$X152, usda$X153, usda$X154, usda$X155, usda$X156, usda$X157, usda$X158, usda$X159, usda$X160, usda$X161, usda$X162, usda$X163, usda$X164, usda$X165, usda$X166, usda$X167, usda$X168, usda$X169, usda$X170, usda$X171, usda$X172, usda$X173, usda$X174, usda$X175, usda$X176, usda$X177, usda$X178, usda$X179, usda$X180, usda$X181, usda$X182, usda$X183, usda$X184, usda$X185, usda$X186, usda$X187, usda$X188, usda$X189, usda$X190, usda$X191, usda$X192, usda$X193, usda$X194, usda$X195, usda$X196, usda$X197, usda$X198, usda$X199, usda$X200, usda$X201, usda$X202, usda$X203, usda$X204, usda$X205, usda$X206, usda$X207, usda$X208, usda$X209, usda$X210, usda$X211, usda$X212, usda$X213, usda$X214, usda$X215, usda$X216, usda$X217, usda$X218, usda$X219, usda$X220, usda$X221, usda$X222, usda$X223, usda$X224, usda$X225, usda$X226, usda$X227, usda$X228, usda$X229, usda$X230, usda$X231, usda$X232, usda$X233, usda$X234, usda$X235, usda$X236, usda$X237, usda$X238, usda$X239, usda$X240, usda$X241, usda$X242, usda$X243, usda$X244, usda$X245, usda$X246, usda$X247, usda$X248, usda$X249, usda$X250, usda$X251, usda$X252, usda$X253, usda$X254, usda$X255, usda$X256, usda$X257, usda$X258, usda$X259, usda$X260, usda$X261, usda$X262, usda$X263, usda$X264, usda$X265, usda$X266, usda$X267, usda$X268, usda$X269, usda$X270, usda$X271, usda$X272, usda$X273, usda$X274, usda$X275, usda$X276, usda$X277, usda$X278, usda$X279, usda$X280, usda$X281, usda$X282, usda$X283, usda$X284, usda$X285, usda$X286, usda$X287, usda$X288, usda$X289, usda$X290, usda$X291, usda$X292, usda$X293, usda$X294, usda$X295, usda$X296, usda$X297, usda$X298, usda$X299, usda$X300, usda$X301, usda$X302, usda$X303, usda$X304, usda$X305, usda$X306, usda$X307, usda$X308, usda$X309, usda$X310, usda$X311, usda$X312, usda$X313, usda$X314, usda$X315, usda$X316, usda$X317, usda$X318, usda$X319, usda$X320, usda$X321, usda$X322, usda$X323, usda$X324, usda$X325, usda$X326, usda$X327, usda$X328, usda$X329, usda$X330, usda$X331, usda$X332, usda$X333, usda$X334, usda$X335, usda$X336, usda$X337, usda$X338, usda$X339, usda$X340, usda$X341, usda$X342, usda$X343, usda$X344, usda$X345, usda$X346, usda$X347, usda$X348, usda$X349, usda$X350, usda$X351, usda$X352, usda$X353, usda$X354, usda$X355, usda$X356, usda$X357, usda$X358, usda$X359, usda$X360, usda$X361, usda$X362, usda$X363, usda$X364, usda$X365, usda$X366, usda$X367, usda$X368, usda$X369, usda$X370, usda$X371, usda$X372, usda$X373, usda$X374, usda$X375, usda$X376, usda$X377, usda$X378, usda$X379, usda$X380, usda$X381, usda$X382, usda$X383, usda$X384, usda$X385, usda$X386, usda$X387, usda$X388, usda$X389, usda$X390, usda$X391, usda$X392, usda$X393, usda$X394, usda$X395, usda$X396, usda$X397, usda$X398, usda$X399, usda$X400, usda$X401, usda$X402, usda$X403, usda$X404, usda$X405, usda$X406, usda$X407, usda$X408, usda$X409, usda$X410, usda$X411, usda$X412, usda$X413, usda$X414, usda$X415, usda$X416, usda$X417, usda$X418, usda$X419, usda$X420, usda$X421, usda$X422, usda$X423, usda$X424, usda$X425, usda$X426, usda$X427, usda$X428, usda$X429, usda$X430, usda$X431, usda$X432, usda$X433, usda$X434, usda$X435, usda$X436, usda$X437, usda$X438, usda$X439, usda$X440, usda$X441, usda$X442, usda$X443, usda$X444, usda$X445, usda$X446, usda$X447, usda$X448, usda$X449, usda$X450, usda$X451, usda$X452, usda$X453, usda$X454, usda$X455, usda$X456, usda$X457, usda$X458, usda$X459, usda$X460, usda$X461, usda$X462, usda$X463, usda$X464, usda$X465, usda$X466, usda$X467, usda$X468, usda$X469, usda$X470, usda$X471, usda$X472, usda$X473, usda$X474, usda$X475, usda$X476, usda$X477, usda$X478, usda$X479, usda$X480, usda$X481, usda$X482, usda$X483, usda$X484, usda$X485, usda$X486, usda$X487, usda$X488, usda$X489, usda$X490, usda$X491, usda$X492, usda$X493, usda$X494, usda$X495, usda$X496, usda$X497, usda$X498, usda$X499, usda$X500, usda$X501, usda$X502, usda$X503, usda$X504, usda$X505, usda$X506, usda$X507, usda$X508, usda$X509, usda$X510, usda$X511, usda$X512, usda$X513, usda$X514, usda$X515, usda$X516, usda$X517, usda$X518, usda$X519, usda$X520, usda$X521, usda$X522, usda$X523, usda$X524, usda$X525, usda$X526, usda$X527, usda$X528, usda$X529, usda$X530, usda$X531, usda$X532, usda$X533, usda$X534, usda$X535, usda$X536, usda$X537, usda$X538, usda$X539, usda$X540, usda$X541, usda$X542, usda$X543, usda$X544, usda$X545, usda$X546, usda$X547, usda$X548, usda$X549, usda$X550, usda$X551, usda$X552, usda$X553, usda$X554, usda$X555, usda$X556, usda$X557, usda$X558, usda$X559, usda$X560, usda$X561, usda$X562, usda$X563, usda$X564, usda$X565, usda$X566, usda$X567, usda$X568, usda$X569, usda$X570, usda$X571, usda$X572, usda$X573, usda$X574, usda$X575, usda$X576, usda$X577, usda$X578, usda$X579, usda$X580, usda$X581, usda$X582, usda$X583, usda$X584, usda$X585, usda$X586, usda$X587, usda$X588, usda$X589, usda$X590, usda$X591, usda$X592, usda$X593, usda$X594, usda$X595, usda$X596, usda$X597, usda$X598, usda$X599, usda$X600, usda$X601, usda$X602, usda$X603, usda$X604, usda$X605, usda$X606, usda$X607, usda$X608, usda$X609, usda$X610, usda$X611, usda$X612, usda$X613, usda$X614, usda$X615, usda$X616, usda$X617, usda$X618, usda$X619, usda$X620, usda$X621, usda$X622, usda$X623, usda$X624, usda$X625, usda$X626, usda$X627, usda$X628, usda$X629, usda$X630, usda$X631, usda$X632, usda$X633, usda$X634, usda$X635, usda$X636, usda$X637, usda$X638, usda$X639, usda$X640, usda$X641, usda$X642, usda$X643, usda$X644, usda$X645, usda$X646, usda$X647, usda$X648, usda$X649, usda$X650, usda$X651, usda$X652, usda$X653, usda$X654, usda$X655, usda$X656, usda$X657, usda$X658, usda$X659, usda$X660, usda$X661, usda$X662, usda$X663, usda$X664, usda$X665, usda$X666, usda$X667, usda$X668, usda$X669, usda$X670, usda$X671, usda$X672, usda$X673, usda$X674, usda$X675, usda$X676, usda$X677, usda$X678, usda$X679, usda$X680, usda$X681, usda$X682, usda$X683, usda$X684, usda$X685, usda$X686, usda$X687, usda$X688, usda$X689, usda$X690, usda$X691, usda$X692, usda$X693, usda$X694, usda$X695, usda$X696, usda$X697, usda$X698, usda$X699, usda$X700, usda$X701, usda$X702, usda$X703, usda$X704, usda$X705, usda$X706, usda$X707, usda$X708, usda$X709, usda$X710, usda$X711, usda$X712, usda$X713, usda$X714, usda$X715, usda$X716, usda$X717, usda$X718, usda$X719, usda$X720, usda$X721, usda$X722, usda$X723, usda$X724, usda$X725, usda$X726, usda$X727, usda$X728, usda$X729, usda$X730, usda$X731, usda$X732, usda$X733, usda$X734, usda$X735, usda$X736, usda$X737, usda$X738, usda$X739, usda$X740, usda$X741, usda$X742, usda$X743, usda$X744, usda$X745, usda$X746, usda$X747, usda$X748, usda$X749, usda$X750, usda$X751, usda$X752, usda$X753, usda$X754, usda$X755, usda$X756, usda$X757, usda$X758, usda$X759, usda$X760, usda$X761, usda$X762, usda$X763, usda$X764, usda$X765, usda$X766, usda$X767, usda$X768, usda$X769, usda$X770, usda$X771, usda$X772, usda$X773, usda$X774, usda$X775, usda$X776, usda$X777, usda$X778, usda$X779, usda$X780, usda$X781, usda$X782, usda$X783, usda$X784, usda$X785, usda$X786, usda$X787, usda$X788, usda$X789, usda$X790, usda$X791, usda$X792, usda$X793, usda$X794, usda$X795, usda$X796, usda$X797, usda$X798, usda$X799, usda$X800, usda$X801, usda$X802, usda$X803, usda$X804, usda$X805, usda$X806, usda$X807, usda$X808, usda$X809, usda$X810, usda$X811, usda$X812, usda$X813, usda$X814, usda$X815, usda$X816, usda$X817, usda$X818, usda$X819, usda$X820, usda$X821, usda$X822, usda$X823, usda$X824, usda$X825, usda$X826, usda$X827, usda$X828, usda$X829, usda$X830, usda$X831, usda$X832, usda$X833, usda$X834, usda$X835, usda$X836, usda$X837, usda$X838, usda$X839, usda$X840, usda$X841, usda$X842, usda$X843, usda$X844, usda$X845, usda$X846, usda$X847, usda$X848, usda$X849, usda$X850, usda$X851, usda$X852, usda$X853, usda$X854, usda$X855, usda$X856, usda$X857, usda$X858, usda$X859, usda$X860, usda$X861, usda$X862, usda$X863, usda$X864, usda$X865, usda$X866, usda$X867, usda$X868, usda$X869, usda$X870, usda$X871, usda$X872, usda$X873, usda$X874, usda$X875, usda$X876, usda$X877, usda$X878, usda$X879, usda$X880, usda$X881, usda$X882, usda$X883, usda$X884, usda$X885, usda$X886, usda$X887, usda$X888, usda$X889, usda$X890, usda$X891, usda$X892, usda$X893, usda$X894, usda$X895, usda$X896, usda$X897, usda$X898, usda$X899, usda$X900, usda$X901, usda$X902, usda$X903, usda$X904, usda$X905, usda$X906, usda$X907, usda$X908, usda$X909, usda$X910, usda$X911, usda$X912, usda$X913, usda$X914, usda$X915, usda$X916, usda$X917, usda$X918, usda$X919, usda$X920, usda$X921, usda$X922, usda$X923, usda$X924, usda$X925, usda$X926, usda$X927, usda$X928, usda$X929),
                  c(">=", "<=", ">=", "<=", ">=", "<=", ">=", "<=", ">=", "<=", ">=", "<=", ">=", "<=",                                   ">=", ">=", ">=", ">=", ">=",
                    "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=",                                   "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<=", "<="),
                  c(input$Prot[1]*7, input$Prot[2]*7, input$SatFat[1]*7, input$SatFat[2]*7, input$Price[1], input$Price[2],
                    input$Sodium[1]*7, input$Sodium[2]*7, input$Fiber[1]*7, input$Fiber[2]*7,
                    input$Sugar[1]*7, input$Sugar[2]*7, input$Cals[1]*7, input$Cals[2]*7, 980, 1200, 1190, 1095, 680,
                    input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv,                       input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv, input$serv))
    # drop any variables that have a 0 coefficient in the model
    x <- data.frame(usda$Desc, usda$FoodType, usda$GramDesc, usda$ProtPerServ, maxProt$solution, usda$GramsPerServ)
    x <- droplevels(x[!(x$maxProt.solution < 1),])
  })
  
  output$textRecom <- renderText({ 
    paste("We recommend spending about $", signif(((input$num[1]+186)/4), 2), "per week on food.
          Enter the range below that you believe reflects this budget:")
  })
  
  # data chart for nutritional recs based on age/sex
  output$nutrients = renderDataTable({
    nutrients
  })
  
  # usda nutritional database
  output$usdaTable = renderDataTable({
    usdaTable
  })
  
  # graph of recommended servings of food based on optim (lp) eq
  x %>%
    ggvis(~usda.Desc, ~maxProt.solution, fill = ~usda.FoodType, stroke = ~usda.GramDesc, strokeWidth := "0") %>%    
    layer_points(size := "400", opacity := "0.8") %>%
    add_tooltip(function(x){paste0("Food: ", x$usda.Desc, "<br>",
                                   "Serving Size: ", x$usda.GramDesc, "<br>",
                                   "Servings: ", signif(x$maxProt.solution, 2), "<br>")}, "hover") %>%
    add_axis("x", title = "", ticks = 14,
             properties = axis_props(
               majorTicks = list(strokeWidth = 2),
               labels = list(
                 angle = 50,
                 fontSize = 10,
                 align = "left",
                 baseline = "middle",
                 dx = 3
               ),
               axis = list(stroke = "#333", strokeWidth = 1.5)
             )
    ) %>%
    add_axis("x", orient = "top", ticks = 0, title = "What Foods Should I Buy?",
             properties = axis_props(
               axis = list(stroke = "white"),
               title = list(fontSize = 16),
               labels = list(fontSize = 0))) %>%
    add_axis("y", title = "Servings Per Week") %>%
    add_relative_scales() %>%
    add_legend("fill", title = "Food Groups") %>%
    hide_legend("stroke") %>%
    #add_legend("stroke", title = "Grams Per Serving", properties = legend_props(legend = list(x = 560, y = 180))) %>%
    set_options(width = "auto", height = "auto", resizable=FALSE, duration = 0) %>%
    bind_shiny("plot1", "plot_ui")
}